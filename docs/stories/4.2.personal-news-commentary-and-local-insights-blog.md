# Story 4.2: Personal News Commentary and Local Insights Blog

## Status
Draft

## Story
**As a** neighborhood insider,  
**I want** regular commentary on local happenings and Indiranagar developments from Amit's perspective,  
**so that** I stay informed about neighborhood changes and understand their impact on local exploration.

## Acceptance Criteria

1. Blog content management system with rich text editor for creating news commentary posts
2. Post categorization system for different content types (neighborhood news, business updates, cultural events)
3. Comment system allowing community discussion on blog posts with moderation capabilities
4. RSS feed and email newsletter subscription options for regular readers
5. Integration with place database linking news stories to relevant locations and businesses
6. Social media auto-posting for blog updates with engagement tracking and analytics
7. Archive system organizing posts by date, category, and topic for easy reference and discovery

## Tasks / Subtasks

- [ ] Build Blog Content Management System (AC: 1)
  - [ ] Create rich text editor with media embedding capabilities
  - [ ] Build blog post creation, editing, and publishing workflow
  - [ ] Add draft system with scheduled publishing
  - [ ] Implement blog post SEO optimization tools
  - [ ] Create blog post preview and revision history

- [ ] Implement Post Categorization System (AC: 2)
  - [ ] Create category management system for different content types
  - [ ] Add tag system for detailed post organization
  - [ ] Build category-based navigation and filtering
  - [ ] Implement category-specific templates and styling
  - [ ] Create category analytics and performance tracking

- [ ] Build Community Comment System (AC: 3)
  - [ ] Create threaded comment system with moderation tools
  - [ ] Add comment approval workflow and spam prevention
  - [ ] Implement user authentication for commenting
  - [ ] Build comment notification system for post authors
  - [ ] Create community guidelines and comment policy enforcement

- [ ] Create RSS and Newsletter System (AC: 4)
  - [ ] Build RSS feed generation for blog updates
  - [ ] Create email newsletter subscription management
  - [ ] Add newsletter template design and customization
  - [ ] Implement automated newsletter sending for new posts
  - [ ] Create subscriber analytics and engagement tracking

- [ ] Integrate with Place Database (AC: 5)
  - [ ] Build place linking system for news stories
  - [ ] Create automatic place mention detection in posts
  - [ ] Add place-specific news aggregation on place pages
  - [ ] Implement business impact tracking from news coverage
  - [ ] Create place-news relationship analytics

- [ ] Implement Social Media Auto-Posting (AC: 6)
  - [ ] Build social media integration for automatic post sharing
  - [ ] Create platform-specific post formatting and optimization
  - [ ] Add social media engagement tracking and analytics
  - [ ] Implement cross-platform posting schedule optimization
  - [ ] Create social media performance metrics dashboard

- [ ] Build Archive and Discovery System (AC: 7)
  - [ ] Create comprehensive blog archive with search functionality
  - [ ] Build topic-based organization and tagging system
  - [ ] Add related post suggestions and discovery features
  - [ ] Implement archive navigation and browsing interface
  - [ ] Create trending topics and popular post highlighting

## Dev Notes

### Previous Story Insights
- **Story 1.2**: Place database provides foundation for place-news integration
- **Story 3.2**: Community engagement patterns provide foundation for comments

### Blog Data Model
```typescript
interface BlogPost {
  id: string;
  title: string;
  slug: string;
  content: string;
  excerpt: string;
  author_id: string;
  category: BlogCategory;
  tags: string[];
  featured_image?: string;
  status: PostStatus;
  published_at?: string;
  updated_at: string;
  view_count: number;
  comment_count: number;
  linked_places: string[];
  seo_metadata: SEOMetadata;
}

interface BlogCategory {
  id: string;
  name: string;
  slug: string;
  description: string;
  color: string;
  post_count: number;
}

interface BlogComment {
  id: string;
  post_id: string;
  author_name: string;
  author_email: string;
  content: string;
  status: CommentStatus;
  parent_id?: string;
  created_at: string;
}

type PostStatus = 'draft' | 'scheduled' | 'published' | 'archived';
type CommentStatus = 'pending' | 'approved' | 'spam' | 'rejected';
```

### File Locations
```
apps/web/
├── app/blog/
│   ├── page.tsx                     # Blog listing page
│   ├── [slug]/page.tsx             # Individual blog post
│   ├── category/[category]/page.tsx # Category-specific posts
│   └── archive/page.tsx            # Blog archive
├── app/admin/blog/
│   ├── page.tsx                    # Blog management dashboard
│   ├── new/page.tsx                # Create new post
│   └── [id]/edit/page.tsx          # Edit existing post
├── components/blog/
│   ├── BlogEditor.tsx              # Rich text editor
│   ├── BlogPost.tsx                # Post display component
│   ├── BlogComments.tsx            # Comment system
│   ├── CategoryNavigation.tsx      # Category browsing
│   ├── NewsletterSignup.tsx        # Email subscription
│   └── RelatedPosts.tsx            # Post suggestions
```

### Rich Text Editor Implementation
```typescript
const BlogEditor = ({ post, onSave }: BlogEditorProps) => {
  const [content, setContent] = useState(post?.content || '');
  const [linkedPlaces, setLinkedPlaces] = useState<Place[]>(post?.linked_places || []);

  const handlePlaceMention = (placeName: string) => {
    const place = findPlaceByName(placeName);
    if (place && !linkedPlaces.find(p => p.id === place.id)) {
      setLinkedPlaces(prev => [...prev, place]);
    }
  };

  const editorConfig = {
    plugins: [
      'advlist', 'autolink', 'lists', 'link', 'image', 'charmap',
      'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
      'insertdatetime', 'media', 'table', 'help', 'wordcount'
    ],
    toolbar: 'undo redo | blocks | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link image media | code',
    setup: (editor: any) => {
      editor.on('input', (e: any) => {
        const text = e.target.getContent({ format: 'text' });
        detectPlaceMentions(text).forEach(handlePlaceMention);
      });
    }
  };

  return (
    <div className="blog-editor">
      <div className="editor-toolbar mb-4">
        <input
          type="text"
          placeholder="Post title"
          className="w-full text-2xl font-bold border-none outline-none mb-4"
          value={post?.title || ''}
        />
        
        <div className="flex items-center space-x-4 mb-4">
          <CategorySelector />
          <TagInput />
          <PublishingOptions />
        </div>
      </div>

      <Editor
        apiKey={process.env.NEXT_PUBLIC_TINYMCE_API_KEY}
        value={content}
        onEditorChange={setContent}
        init={editorConfig}
      />

      {linkedPlaces.length > 0 && (
        <div className="linked-places mt-4">
          <h3 className="font-medium mb-2">Linked Places</h3>
          <div className="flex flex-wrap gap-2">
            {linkedPlaces.map(place => (
              <PlaceChip key={place.id} place={place} />
            ))}
          </div>
        </div>
      )}
    </div>
  );
};
```

### Newsletter System Integration
```typescript
const NewsletterSystem = {
  subscribeUser: async (email: string, preferences: NewsletterPreferences) => {
    const subscriber = await createSubscriber({
      email,
      preferences,
      subscribed_at: new Date().toISOString(),
      status: 'active'
    });

    await sendWelcomeEmail(subscriber);
    return subscriber;
  },

  sendNewsletterForPost: async (post: BlogPost) => {
    const subscribers = await getActiveSubscribers();
    const relevantSubscribers = filterSubscribersByInterest(subscribers, post);

    const newsletterContent = generateNewsletterContent(post);
    
    for (const subscriber of relevantSubscribers) {
      await queueNewsletterEmail({
        to: subscriber.email,
        subject: `New from Indiranagar Discovery: ${post.title}`,
        content: personalizeContent(newsletterContent, subscriber),
        unsubscribe_link: generateUnsubscribeLink(subscriber.id)
      });
    }
  },

  generateRSSFeed: () => {
    const recentPosts = getRecentPosts(20);
    
    return generateRSS({
      title: "Indiranagar Discovery Blog",
      description: "Local insights and neighborhood commentary from Amit",
      link: `${process.env.NEXT_PUBLIC_BASE_URL}/blog`,
      items: recentPosts.map(post => ({
        title: post.title,
        description: post.excerpt,
        link: `${process.env.NEXT_PUBLIC_BASE_URL}/blog/${post.slug}`,
        pubDate: post.published_at,
        categories: [post.category.name, ...post.tags]
      }))
    });
  }
};
```

### Key Features
- **Rich Content Creation**: Advanced editor with media embedding and place linking
- **Community Engagement**: Comment system with moderation and spam prevention
- **Content Discovery**: Comprehensive categorization, tagging, and search
- **Audience Building**: Newsletter and RSS feed for regular readers
- **Cross-Platform Publishing**: Automatic social media distribution
- **Place Integration**: Automatic linking between blog posts and places

## Testing

### Key Test Scenarios
- Blog post creation, editing, and publishing workflow
- Comment system functionality and moderation
- Newsletter subscription and email delivery
- RSS feed generation and validation
- Place linking and automatic mention detection
- Social media auto-posting and engagement tracking
- Archive system navigation and search functionality

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| [Current Date] | 1.0 | Initial story creation with comprehensive blog and news commentary system | Scrum Master |

## Dev Agent Record

This section is populated by the development agent during implementation.

## QA Results

Results from QA Agent QA review of the completed story implementation.